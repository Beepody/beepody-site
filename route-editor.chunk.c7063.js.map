{"version":3,"sources":["webpack:///./routes/editor/index.tsx","webpack:///../../src/index.ts","webpack:///../node_modules/use-hash-state/lib/use-hash-state.js","webpack:///../node_modules/use-hash-state/lib/utils.js"],"names":["CodeEditor","props","ref","createRef","class","onInput","e","target","HTMLTextAreaElement","sequence","parseSequence","value","setSequence","setStatus","code","BeepEditor","state","setStateAtKey","useHashState","initialSequence","length","parseBeepHash","BeepSequence","useState","status","GRUBCode","setGRUBCode","toGRUBInitTune","beepCode","setBeepCode","toBeepCommand","href","type","parseGRUBInitTune","toHash","parseBeepCommand","onClick","playBeepSequence","beeps","Number","lengthInSeconds","toFixed","debounce","func","waitMilliseconds","options","nextInvokeTimeout","maxWait","timeSinceLastInvocation","Date","now","lastInvokeTime","timeoutId","isImmediate","debouncedFunction","args","context","this","invokeFunction","apply","shouldCallNow","clearTimeout","setTimeout","cancel","__assign","Object","assign","t","s","i","n","arguments","p","prototype","hasOwnProperty","call","defineProperty","exports","react_1","require","ts_debounce_1","utils_1","DEFAULT_OPTIONS","usePushState","validateKeysAndTypes","parseStateFromUrl","validator","window","hash","location","slice","obj","JSON","parse","decodeURIComponent","console","warn","writeStateToUrl","newState","json","stringify","title","document","url","pathname","encodeURIComponent","history","pushState","undefined","replaceState","buildValidator","initialState","customValidator","validators","push","initialStateKeys","Set","keys","initialStateTypes","key","dict","setsAreEqual","objKeys","getKeysAndTypesValidator","every","v","default","initialValidator","_a","_b","_c","didRender","useRef","current","parsedState","validatorRef","_d","setState","useEffect","onHashChange","addEventListener","removeEventListener","prevState","setA","setB","size","diff","forEach","item","delete"],"mappings":"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","file":"route-editor.chunk.c7063.js","sourcesContent":["import { parseBeepCommand, parseGRUBInitTune, parseBeepHash, playBeepSequence } from 'beepody/dist/tsc/beepody'\nimport { BeepSequence } from 'beepody/dist/tsc/main'\nimport { createRef, FunctionalComponent, h } from 'preact'\nimport { Link } from 'preact-router'\nimport { useState } from 'preact/hooks'\nimport Helmet from 'react-helmet'\nimport useHashState from 'use-hash-state'\n\ntype ParseSequenceFunction = (sequence: string) => BeepSequence\ntype SetSequenceFunction = (sequence: BeepSequence) => void\ntype SetStatusFunction = (status: string) => void\n\ninterface CodeEditorProps {\n  code: string;\n  parseSequence: ParseSequenceFunction;\n  setSequence: SetSequenceFunction;\n  setStatus: SetStatusFunction;\n}\n\nconst CodeEditor: FunctionalComponent<CodeEditorProps> = (props: CodeEditorProps) => {\n  const ref = createRef()\n  const handleInput = (e: Event): void => {\n    if (e.target instanceof HTMLTextAreaElement) {\n      const sequence = props.parseSequence(e.target.value)\n      props.setSequence(sequence)\n      props.setStatus('Nice beep')\n    }\n  }\n\n  return (\n    <div ref={ref}>\n      <textarea class=\"alert alert-dark w-100 font-monospace\" onInput={handleInput}>{props.code}</textarea>\n    </div>\n  )\n}\n\nconst BeepEditor: FunctionalComponent = () => {\n  const ref = createRef<HTMLElement>()\n  const initialHashState = {0: ''}\n  const {state, setStateAtKey} = useHashState(initialHashState)\n  const initialSequence = state[0].length ? parseBeepHash(state[0]) : new BeepSequence([])\n  const [sequence, setSequence] = useState(initialSequence)\n  const [status, setStatus] = useState('Ready to beep')\n  const [GRUBCode, setGRUBCode] = useState(initialSequence.toGRUBInitTune())\n  const [beepCode, setBeepCode] = useState(initialSequence.toBeepCommand())\n  const handlePlayClick = (): void => {\n    playBeepSequence(sequence)\n  }\n  const handleGRUBCodeUpdate = (sequence: BeepSequence): void => {\n    setSequence(sequence)\n    setStateAtKey(0, sequence.toHash())\n    setBeepCode(sequence.toBeepCommand())\n  }\n  const handleBeepCodeUpdate = (sequence: BeepSequence): void => {\n    setSequence(sequence)\n    setStateAtKey(0, sequence.toHash())\n    setGRUBCode(sequence.toGRUBInitTune())\n  }\n\n  return (\n    <section class=\"container py-5\" ref={ref}>\n      <Helmet><title>Beep Editor</title></Helmet>\n\n      <h1>Beep Editor</h1>\n\n      <Link href=\"/about/#grub-format\" type=\"button\" class=\"btn btn-secondary float-end\">GRUB Format</Link>\n      <h2>GRUB Init Tune</h2>\n      <CodeEditor code={GRUBCode} parseSequence={parseGRUBInitTune} setSequence={handleGRUBCodeUpdate} setStatus={setStatus} />\n      \n      <Link href=\"/about/#beep-format\" class=\"btn btn-secondary float-end\">Beep Format</Link>\n      <h2>Beep Command</h2>\n      <CodeEditor code={beepCode} parseSequence={parseBeepCommand} setSequence={handleBeepCodeUpdate} setStatus={setStatus} />\n\n      <button onClick={handlePlayClick} type=\"button\" class=\"btn btn-success float-end\">Play</button>\n\n      <h2>Status</h2>\n      <p>{status}</p>\n      <ul>\n        <li>\n          Beeps: {sequence.beeps.length}\n        </li>\n        <li>\n          Play time: {Number(sequence.lengthInSeconds().toFixed(1))} seconds\n        </li>\n      </ul>\n    </section>\n  )\n}\n\nexport default BeepEditor\n","/**\n * A function that emits a side effect and does not return anything.\n */\nexport type Procedure = (...args: any[]) => void;\n\nexport type Options = {\n  isImmediate?: boolean;\n  maxWait?: number;\n};\n\nexport interface DebouncedFunction<F extends Procedure> {\n  (this: ThisParameterType<F>, ...args: Parameters<F>): void;\n  cancel: () => void;\n}\n\nexport function debounce<F extends Procedure>(\n  func: F,\n  waitMilliseconds = 50,\n  options: Options = {}\n): DebouncedFunction<F> {\n  let timeoutId: ReturnType<typeof setTimeout> | undefined;\n  const isImmediate = options.isImmediate ?? false;\n  const maxWait = options.maxWait;\n  let lastInvokeTime = Date.now();\n\n  function nextInvokeTimeout() {\n    if (maxWait !== undefined) {\n      const timeSinceLastInvocation = Date.now() - lastInvokeTime;\n\n      if (timeSinceLastInvocation + waitMilliseconds >= maxWait) {\n        return maxWait - timeSinceLastInvocation;\n      }\n    }\n\n    return waitMilliseconds;\n  }\n\n  const debouncedFunction = function (\n    this: ThisParameterType<F>,\n    ...args: Parameters<F>\n  ) {\n    const context = this;\n\n    const invokeFunction = function () {\n      timeoutId = undefined;\n      lastInvokeTime = Date.now();\n      if (!isImmediate) {\n        func.apply(context, args);\n      }\n    };\n\n    const shouldCallNow = isImmediate && timeoutId === undefined;\n\n    if (timeoutId !== undefined) {\n      clearTimeout(timeoutId);\n    }\n\n    timeoutId = setTimeout(invokeFunction, nextInvokeTimeout());\n\n    if (shouldCallNow) {\n      func.apply(context, args);\n    }\n  };\n\n  debouncedFunction.cancel = function () {\n    if (timeoutId !== undefined) {\n      clearTimeout(timeoutId);\n    }\n  };\n\n  return debouncedFunction;\n}\n","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar react_1 = require(\"react\");\nvar ts_debounce_1 = require(\"ts-debounce\");\nvar utils_1 = require(\"./utils\");\nvar DEFAULT_OPTIONS = {\n    usePushState: false,\n    validateKeysAndTypes: true,\n};\nvar DEBOUNCE_WRITE_URL_MS = 100;\nvar parseStateFromUrl = function (validator) {\n    if (typeof window === 'undefined') {\n        return;\n    }\n    var hash = window.location.hash.slice(1);\n    if (!hash) {\n        return;\n    }\n    try {\n        var obj = JSON.parse(decodeURIComponent(hash));\n        if (!obj) {\n            return;\n        }\n        if (validator) {\n            if (validator(obj)) {\n                return obj;\n            }\n            else {\n                console.warn('Object in URL hash is invalid, ignoring');\n                console.warn(obj);\n            }\n        }\n        else {\n            return obj;\n        }\n    }\n    catch (e) {\n        console.warn('URL hash is not valid JSON, ignoring');\n        // JSON parsing failed\n    }\n    return undefined;\n};\nvar writeStateToUrl = ts_debounce_1.debounce(function (newState, usePushState) {\n    if (usePushState === void 0) { usePushState = false; }\n    if (typeof window === 'undefined') {\n        return;\n    }\n    var json = JSON.stringify(newState);\n    var title = document.title;\n    var url = window.location.pathname + \"#\" + encodeURIComponent(json);\n    if (usePushState) {\n        window.history.pushState(undefined, title, url);\n    }\n    else {\n        window.history.replaceState(undefined, title, url);\n    }\n}, DEBOUNCE_WRITE_URL_MS);\nvar getKeysAndTypesValidator = function (initialState) {\n    var initialStateKeys = new Set(Object.keys(initialState));\n    var initialStateTypes = {};\n    for (var key in initialState) {\n        initialStateTypes[key] = typeof initialState[key];\n    }\n    return function (obj) {\n        if (typeof obj !== 'object' || obj === null) {\n            return false;\n        }\n        var dict = obj;\n        if (!utils_1.setsAreEqual(initialStateKeys, new Set(Object.keys(dict)))) {\n            return false;\n        }\n        var objKeys = Object.keys(dict);\n        for (var i = 0; i < objKeys.length; i++) {\n            var key = objKeys[i];\n            var value = dict[key];\n            var keyType = typeof value;\n            if (keyType !== initialStateTypes[key]) {\n                return false;\n            }\n        }\n        return true;\n    };\n};\nvar buildValidator = function (initialState, validateKeysAndTypes, customValidator) {\n    var validators = [];\n    if (validateKeysAndTypes) {\n        validators.push(getKeysAndTypesValidator(initialState));\n    }\n    if (customValidator) {\n        validators.push(customValidator);\n    }\n    return function (obj) { return validators.every(function (v) { return v(obj); }); };\n};\nvar useHashState = function (initialState, options) {\n    var _a = __assign(__assign({}, DEFAULT_OPTIONS), options), _b = _a.usePushState, usePushState = _b === void 0 ? false : _b, _c = _a.validateKeysAndTypes, validateKeysAndTypes = _c === void 0 ? true : _c, customValidator = _a.customValidator;\n    var didRender = react_1.useRef(false);\n    var initialValidator;\n    if (!didRender.current) {\n        initialValidator = buildValidator(initialState, validateKeysAndTypes, customValidator);\n        // Synchronously check the URL hash on the first render,\n        // so that the state returned to the caller is the URL state\n        // if one is defined.\n        var parsedState = parseStateFromUrl(initialValidator);\n        if (parsedState) {\n            initialState = parsedState;\n        }\n        else if (initialState) {\n            writeStateToUrl(initialState, usePushState);\n        }\n        didRender.current = true;\n    }\n    var validatorRef = react_1.useRef(initialValidator);\n    var _d = react_1.useState(initialState), state = _d[0], setState = _d[1];\n    react_1.useEffect(function () {\n        validatorRef.current = buildValidator(initialState, validateKeysAndTypes, customValidator);\n    }, [initialState, validateKeysAndTypes, customValidator]);\n    var onHashChange = function () {\n        var parsedState = parseStateFromUrl(validatorRef.current);\n        if (parsedState) {\n            setState(parsedState);\n        }\n    };\n    react_1.useEffect(function () {\n        window.addEventListener('hashchange', onHashChange);\n        return function () {\n            window.removeEventListener('hashchange', onHashChange);\n        };\n    }, []);\n    var setStateAtKey = function (key, value) {\n        setState(function (prevState) {\n            var _a;\n            var newState = __assign(__assign({}, prevState), (_a = {}, _a[key] = value, _a));\n            writeStateToUrl(newState, usePushState);\n            return newState;\n        });\n    };\n    return { state: state, setStateAtKey: setStateAtKey };\n};\nexports.default = useHashState;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.setsAreEqual = function (setA, setB) {\n    if (setA.size !== setB.size) {\n        return false;\n    }\n    var diff = new Set(setB);\n    setA.forEach(function (item) {\n        diff.delete(item);\n    });\n    return diff.size === 0;\n};\n"],"sourceRoot":""}